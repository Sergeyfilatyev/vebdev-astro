---
import Button from '../ui/Button.astro';

const {title, subtitle, projects, showAllButton, buttonText} = Astro.props;
const locale = Astro.props.locale || 'uk';

const getLocalizedLink = (link: string, currentLocale: string): string => {
	const defaultLang = 'uk';
	if (link === '/') {
		if (currentLocale !== defaultLang) {
			return `/${currentLocale}`;
		}
		return '/';
	}
	if (link.startsWith('/') || link.includes('://')) {
		return link;
	}
	if (currentLocale === defaultLang) {
		return `/${link}`;
	} else {
		return `/${currentLocale}/${link}`;
	}
};
---

<section class='relative py-24 md:py-32 bg-gradient-to-b from-primary-900 via-primary-800 to-primary-900 overflow-hidden'>
	<div class='absolute inset-0 opacity-20'>
		<div class='absolute top-0 left-1/4 w-96 h-96 bg-primary-500/20 rounded-full blur-3xl'></div>
		<div class='absolute bottom-0 right-1/4 w-96 h-96 bg-primary-200/20 rounded-full blur-3xl'></div>
	</div>

	<div class='container px-4 relative z-10'>
		{title && (
			<h2 class='text-4xl md:text-5xl lg:text-6xl font-bold text-center mb-6 fade-in-up'>
				<span class='gradient-text'>{title}</span>
			</h2>
		)}
		{subtitle && (
			<p class='text-lg md:text-xl text-center text-primary-150 mb-16 max-w-2xl mx-auto fade-in-up fade-in-delay-1'>
				{subtitle}
			</p>
		)}

		{projects && projects.length > 0 && (
			<div class='portfolio-slider-wrapper mb-12'>
				<div class='swiper portfolio-swiper'>
					<div class='swiper-wrapper'>
						{projects.map((project: any, index: number) => {
							const projectData = typeof project === 'object' ? project : null;
							if (!projectData) return null;

							const imageUrl = projectData.image?.url || projectData.image;

							return (
								<div class='swiper-slide' style={`animation-delay: ${index * 0.1}s`}>
									<a
										href={getLocalizedLink(`/portfolio/${projectData.slug}`, locale)}
										class='group block h-full bg-gradient-to-br from-primary-850 via-primary-800 to-primary-850 rounded-2xl overflow-hidden border border-primary-700/50 hover:border-primary-500/50 transition-all duration-500 hover:shadow-2xl hover:shadow-primary-500/20 hover:-translate-y-2'>
										{imageUrl && (
											<div class='relative aspect-video overflow-hidden'>
												<div class='absolute inset-0 bg-gradient-to-t from-primary-900/80 via-transparent to-transparent z-10'></div>
												<img
													src={imageUrl}
													alt={projectData.title || 'Project'}
													class='w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700'
													loading='lazy'
												/>
												<div class='absolute inset-0 z-20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300'>
													<div class='bg-primary-500/90 backdrop-blur-sm px-6 py-3 rounded-full text-primary-900 font-bold transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300'>
														Переглянути →
													</div>
												</div>
											</div>
										)}
										<div class='p-8'>
											{projectData.title && (
												<h3 class='text-2xl font-bold text-primary-50 mb-3 group-hover:text-primary-200 transition-colors'>
													{projectData.title}
												</h3>
											)}
											{projectData.subtitle && (
												<p class='text-primary-200 mb-4 font-semibold'>{projectData.subtitle}</p>
											)}
											{projectData.description && (
												<p class='text-sm text-primary-150 line-clamp-2 leading-relaxed'>{projectData.description}</p>
											)}
										</div>
									</a>
								</div>
							);
						})}
					</div>
					<div class='swiper-pagination portfolio-pagination mt-8'></div>
					<div class='swiper-button-next portfolio-next'></div>
					<div class='swiper-button-prev portfolio-prev'></div>
				</div>
			</div>
		)}

		{showAllButton && buttonText && (
			<div class='text-center fade-in-up fade-in-delay-2'>
				<Button variant='primary' size='lg' isLink href={getLocalizedLink('/portfolio', locale)} class='glow-effect'>
					{buttonText}
				</Button>
			</div>
		)}
	</div>
</section>

<script>
	import {Swiper} from 'swiper';
	import {Navigation, Pagination, Autoplay} from 'swiper/modules';
	import 'swiper/css';
	import 'swiper/css/navigation';
	import 'swiper/css/pagination';

	const portfolioSwiperEl = document.querySelector('.portfolio-swiper');
	if (portfolioSwiperEl) {
		new Swiper('.portfolio-swiper', {
			modules: [Navigation, Pagination, Autoplay],
			slidesPerView: 1,
			spaceBetween: 24,
			loop: true,
			autoplay: {
				delay: 5000,
				disableOnInteraction: false,
			},
			breakpoints: {
				640: {
					slidesPerView: 2,
				},
				1024: {
					slidesPerView: 3,
				},
			},
			navigation: {
				nextEl: '.portfolio-next',
				prevEl: '.portfolio-prev',
			},
			pagination: {
				el: '.portfolio-pagination',
				clickable: true,
			},
		});
	}
</script>

<style>
	.portfolio-swiper {
		padding-bottom: 60px;
	}

	.portfolio-next,
	.portfolio-prev {
		color: var(--color-primary-500) !important;
		width: 48px !important;
		height: 48px !important;
		margin-top: -24px !important;
		top: 50% !important;
		z-index: 10 !important;
		opacity: 0.8;
		transition: opacity 0.3s ease;
	}

	.portfolio-next:hover,
	.portfolio-prev:hover {
		opacity: 1;
	}

	.portfolio-next::after,
	.portfolio-prev::after {
		font-size: 24px !important;
		font-weight: 700 !important;
	}

	.portfolio-pagination .swiper-pagination-bullet {
		background: var(--color-primary-700);
		opacity: 0.5;
		width: 12px;
		height: 12px;
		transition: all 0.3s ease;
	}

	.portfolio-pagination .swiper-pagination-bullet-active {
		background: var(--color-primary-500);
		opacity: 1;
		width: 32px;
		border-radius: 6px;
	}
</style>
