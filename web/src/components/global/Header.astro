---
import {Icon} from 'astro-icon/components';
import Button from '@/components/ui/Button.astro';

// @ts-ignore - Astro is a global in Astro components
const {settings, locale} = Astro.props;

const getLocalizedLink = (link: string, currentLocale: string): string => {
	const defaultLang = 'uk';
	if (link === '/') {
		if (currentLocale !== defaultLang) {
			return `/${currentLocale}`;
		}
		return '/';
	}

	if (link.startsWith('/') || link.includes('://')) {
		return link;
	}

	if (currentLocale === defaultLang) {
		return `/${link}`;
	} else {
		return `/${currentLocale}/${link}`;
	}
};

const logotipUrl =
	settings?.logo?.sizes?.thumbnail?.url || settings?.logo?.url || null;

const navigation = settings?.navigation || [];
const ctaButton = settings?.ctaButton || {};
const phone = settings?.phone || '';
---

<header
	class='sticky top-0 z-50 bg-primary-900/95 backdrop-blur-sm border-b border-primary-700/50'
	id='header'>
	<div class='container px-4'>
		<div class='flex items-center justify-between h-20 gap-4'>
			<!-- Logo -->
			<a
				class='flex items-center gap-2 transition-transform duration-300 hover:scale-105'
				aria-label='Veb-Dev Home'
				href={getLocalizedLink('/', locale)}>
				{
					logotipUrl && (
						<img
							src={logotipUrl}
							alt={settings?.logo?.alt || 'Logo'}
							class='h-10 lg:h-12 w-auto object-contain'
						/>
					)
				}
			</a>

			<!-- Desktop Navigation -->
			<nav class='hidden lg:flex items-center gap-6'>
				{
					navigation.map((item: any) => (
						<a
							href={getLocalizedLink(item.url, locale)}
							class='text-primary-100 hover:text-primary-200 transition-colors font-medium'>
							{item.label}
						</a>
					))
				}
			</nav>

			<!-- Right Side -->
			<div class='flex items-center gap-3'>
				{
					phone && (
						<a
							href={`tel:${phone}`}
							class='hidden sm:flex items-center gap-2 text-primary-100 hover:text-primary-200 transition-colors'>
							<Icon name='mdi:phone' />
							<span class='text-sm'>{phone}</span>
						</a>
					)
				}

				{
					ctaButton?.text && ctaButton?.url && (
						<Button
							variant='primary'
							size='sm'
							isLink
							href={getLocalizedLink(ctaButton.url, locale)}
							class='hidden sm:inline-flex'>
							{ctaButton.text}
						</Button>
					)
				}

				<!-- Mobile Menu Button -->
				<Button
					variant='ghost'
					size='icon'
					id='mobileMenuOpenBtn'
					class='text-primary-50 w-10 h-10 lg:hidden'
					aria-label='Open Mobile Menu'>
					<Icon
						name='mdi:menu'
						size={24}
					/>
				</Button>

				<!-- Language Switcher -->
				<div
					class='hidden sm:flex items-center gap-1 text-xs border-l border-primary-700 pl-3 ml-3'>
					{
						locale === 'ru' ? (
							<span class='text-primary-100 font-medium'>RU</span>
						) : (
							<a
								href={getLocalizedLink('/', 'ru')}
								class='text-primary-500 hover:text-primary-300 transition-colors'>
								RU
							</a>
						)
					}
					<span class='text-primary-500'>|</span>
					{
						locale === 'uk' ? (
							<span class='text-primary-100 font-medium'>UA</span>
						) : (
							<a
								href={getLocalizedLink('/', 'uk')}
								class='text-primary-500 hover:text-primary-300 transition-colors'>
								UA
							</a>
						)
					}
					<span class='text-primary-500'>|</span>
					{
						locale === 'en' ? (
							<span class='text-primary-100 font-medium'>EN</span>
						) : (
							<a
								href={getLocalizedLink('/', 'en')}
								class='text-primary-500 hover:text-primary-300 transition-colors'>
								EN
							</a>
						)
					}
				</div>
			</div>
		</div>
	</div>

	<!-- Mobile Menu -->
	<div
		id='mobileMenu'
		class='hidden lg:hidden bg-primary-900 border-t border-primary-700'>
		<nav class='container px-4 py-4'>
			<ul class='space-y-3'>
				{
					navigation.map((item: any) => (
						<li>
							<a
								href={getLocalizedLink(item.url, locale)}
								class='block py-2 text-primary-100 hover:text-primary-200 transition-colors'>
								{item.label}
							</a>
						</li>
					))
				}
			</ul>
		</nav>
	</div>
</header>

<script>
	const mobileMenuBtn = document.getElementById('mobileMenuOpenBtn');
	const mobileMenu = document.getElementById('mobileMenu');

	if (mobileMenuBtn && mobileMenu) {
		mobileMenuBtn.addEventListener('click', () => {
			mobileMenu.classList.toggle('hidden');
		});
	}
</script>
